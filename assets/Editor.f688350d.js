var h=Object.defineProperty,p=Object.defineProperties;var m=Object.getOwnPropertyDescriptors;var s=Object.getOwnPropertySymbols;var f=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable;var a=(t,e,i)=>e in t?h(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,n=(t,e)=>{for(var i in e||(e={}))f.call(e,i)&&a(t,i,e[i]);if(s)for(var i of s(e))y.call(e,i)&&a(t,i,e[i]);return t},o=(t,e)=>p(t,m(e));import{E as g}from"./Editor.4d648d65.js";import{n as $,j as d,i as D,u as A,E,A as b,o as c,k as v}from"./index.d5de1f84.js";import"./MarkdownEditor.umd.9fc6c46c.js";import"./vendor.71bc5b01.js";var _=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Editor",{ref:"editable",attrs:{appearance:t.appearance,initialCursor:t.initialCursor,initialSelection:t.initialSelection,initialVimMode:t.initialVimMode,settings:t.settings,text:t.document.text},on:{input:t.input}})},S=[];const w={name:"EditorView",components:{Editor:g},props:{id:String,initialCursor:{type:Object,default:()=>({character:0,line:0}),validator:t=>t.hasOwnProperty("character")&&t.hasOwnProperty("line")},initialFocus:{type:String,default:()=>"any",validator:t=>["any","start","end"].includes(t)},initialSelection:{type:Object},initialVimMode:{type:String},readonly:{type:Boolean}},data(){return{editor:null,placeholder:new d}},watch:{document(){this.$refs.editable.clearHistory(),this.$refs.editable.focusEditor()}},computed:{appearance(){return this.$store.state.settings.theme==="october"?"dark":this.$store.state.settings.theme},currentDoc(){return this.$store.getters.currentDoc},document(){return this.$store.getters.decrypted.find(t=>t.id===this.id)||this.placeholder},ink(){return this.settings.version==="ink"},settings(){return this.$store.state.settings.editor}},methods:{async findSharedDocument(){const t=await D.collection("documents").where("public","==",!0).where("id","==",this.$route.params.id).get(),[e,...i]=t.docs,r=e.data(),u=o(n({},r),{id:r.id||r.clientId,firebaseId:e.id,textKey:r.textKey||r.dataKey,createdAt:r.createdAt?r.createdAt.toDate():null,discardedAt:r.discardedAt?r.discardedAt.toDate():null,updatedAt:r.updatedAt?r.updatedAt.toDate():null,touchedAt:r.touchedAt?r.touchedAt.toDate():null,syncedAt:r.syncedAt.toDate()});return A(u,{privateKey:this.$store.state.settings.crypto.privateKey})},async input(t){this.id?this.$store.dispatch(E,{id:this.document.id,text:t}):(this.$store.dispatch(b,new d({id:this.document.id,text:t})),this.ink?c({name:"document",params:{id:this.document.id,initialSelection:this.$refs.editable.getSelection()}}):c({name:"document",params:{id:this.document.id,initialCursor:{character:this.$refs.editable.getCursor().ch,line:this.$refs.editable.getCursor().line},initialVimMode:this.$refs.editable.getKeyMap()}}))}},beforeRouteUpdate(t,e,i){t.name==="document"&&this.$store.dispatch(v,{id:t.params.id}),i()},async mounted(){this.readonly&&(this.placeholder=await this.findSharedDocument())}},l={};var C=$(w,_,S,!1,M,null,null,null);function M(t){for(let e in l)this[e]=l[e]}var T=function(){return C.exports}();export{T as default};
