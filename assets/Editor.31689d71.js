var h=Object.defineProperty,p=Object.defineProperties;var m=Object.getOwnPropertyDescriptors;var a=Object.getOwnPropertySymbols;var f=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable;var r=(t,e,i)=>e in t?h(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,n=(t,e)=>{for(var i in e||(e={}))f.call(e,i)&&r(t,i,e[i]);if(a)for(var i of a(e))y.call(e,i)&&r(t,i,e[i]);return t},d=(t,e)=>p(t,m(e));import{E as g}from"./Editor.a468e0e6.js";import{n as $,j as o,s as D,k as A,i as E,u as b,E as v,A as _,o as c,l as S}from"./index.9ca76a06.js";import"./MarkdownEditor.umd.9fc6c46c.js";import"./vendor.71bc5b01.js";var T=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Editor",{ref:"editable",attrs:{appearance:t.appearance,initialCursor:t.initialCursor,initialSelection:t.initialSelection,initialVimMode:t.initialVimMode,settings:t.settings,text:t.document.text},on:{input:t.input}})},w=[];const C={name:"EditorView",components:{Editor:g},props:{id:String,initialCursor:{type:Object,default:()=>({character:0,line:0}),validator:t=>t.hasOwnProperty("character")&&t.hasOwnProperty("line")},initialFocus:{type:String,default:()=>"any",validator:t=>["any","start","end"].includes(t)},initialSelection:{type:Object},initialVimMode:{type:String},readonly:{type:Boolean}},data(){return{editor:null,placeholder:new o}},watch:{document(){this.$refs.editable.clearHistory(),this.$refs.editable.focusEditor()},tags(){this.updateTitle()},header(){this.updateTitle()}},computed:{appearance(){return this.$store.state.settings.theme==="october"?"dark":this.$store.state.settings.theme},currentDoc(){return this.$store.getters.currentDoc},document(){return this.$store.getters.decrypted.find(t=>t.id===this.id)||this.placeholder},ink(){return this.settings.version==="ink"},settings(){return this.$store.state.settings.editor},tags(){return this.document.tags},header(){return this.document.headers[0]}},methods:{async updateTitle(){D(this.document.headers[0]||A(this.document.tags))},async findSharedDocument(){const t=await E.collection("documents").where("public","==",!0).where("id","==",this.$route.params.id).get(),[e,...i]=t.docs,s=e.data(),u=d(n({},s),{id:s.id||s.clientId,firebaseId:e.id,textKey:s.textKey||s.dataKey,createdAt:s.createdAt?s.createdAt.toDate():null,discardedAt:s.discardedAt?s.discardedAt.toDate():null,updatedAt:s.updatedAt?s.updatedAt.toDate():null,touchedAt:s.touchedAt?s.touchedAt.toDate():null,syncedAt:s.syncedAt.toDate()});return b(u,{privateKey:this.$store.state.settings.crypto.privateKey})},async input(t){this.id?this.$store.dispatch(v,{id:this.document.id,text:t}):(this.$store.dispatch(_,new o({id:this.document.id,text:t})),this.ink?c({name:"document",params:{id:this.document.id,initialSelection:this.$refs.editable.getSelection()}}):c({name:"document",params:{id:this.document.id,initialCursor:{character:this.$refs.editable.getCursor().ch,line:this.$refs.editable.getCursor().line},initialVimMode:this.$refs.editable.getKeyMap()}}))}},beforeRouteUpdate(t,e,i){t.name==="document"&&this.$store.dispatch(S,{id:t.params.id}),i()},async mounted(){this.updateTitle(),this.readonly&&(this.placeholder=await this.findSharedDocument())}},l={};var M=$(C,T,w,!1,j,null,null,null);function j(t){for(let e in l)this[e]=l[e]}var I=function(){return M.exports}();export{I as default};
